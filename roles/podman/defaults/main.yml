# Podman packages to install
podman_packages:
  - podman
  - buildah
  - skopeo
  - crun  # High-performance OCI runtime (20-30% faster than runc)

# Podman APT repository (Debian/Ubuntu)
podman_apt_repository: >-
  deb [arch={{ podman_apt_arch }} signed-by=/etc/apt/keyrings/podman.asc]
  https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/{{
  'xUbuntu_' ~ ansible_distribution_version if ansible_distribution == 'Ubuntu'
  else 'Debian_' ~ ansible_distribution_major_version }}/
  /
podman_apt_arch: >-
  {{ 'amd64' if ansible_architecture == 'x86_64'
  else 'arm64' if ansible_architecture == 'aarch64'
  else ansible_architecture }}

podman_apt_gpg_key: >-
  https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/{{
  'xUbuntu_' ~ ansible_distribution_version if ansible_distribution == 'Ubuntu'
  else 'Debian_' ~ ansible_distribution_major_version }}/Release.key

# Podman configuration
podman_registries_conf:
  unqualified-search-registries:
    - docker.io
    - quay.io

# Insecure registries (registries without HTTPS or with self-signed certificates)
# WARNING: Only use this for trusted internal registries!
podman_insecure_registries: []
  # Example:
  # - "registry.internal.company.com:5000"
  # - "192.168.1.100:5000"
  # - "localhost:5000"

# Podman registries configuration file path
podman_registries_conf_path: /etc/containers/registries.conf

# Podman storage configuration file path
podman_storage_conf_path: /etc/containers/storage.conf

# Reset Podman storage when changing drivers (WARNING: DELETES ALL CONTAINERS/IMAGES!)
# Set to true to allow automatic reset when storage driver changes
podman_reset_storage_on_driver_change: false

# Podman storage configuration
# Performance-optimized default configuration
podman_storage_conf:
  storage:
    driver: "overlay"
    runroot: "/run/containers/storage"
    graphroot: "/var/lib/containers/storage"
    options:
      overlay:
        mountopt: "nodev,metacopy=on"  # metacopy reduces I/O operations
        # force_mask: "0000"  # Removed: Only works with mount_program (fuse-overlayfs)
                              # Enable manually if using fuse-overlayfs in rootless mode
  
  engine:
    runtime: "crun"                    # 20-30% faster than runc
    events_logger: "file"
    cgroup_manager: "systemd"
    num_locks: 2048
    image_parallel_copies: 10          # Parallel layer copies during pull

# Configure Podman repository
podman_configure_repo: true

# Prerequisites packages
podman_prerequisites_debian:
  - apt-transport-https
  - ca-certificates
  - curl
  - gnupg

podman_prerequisites_redhat:
  - yum-utils

# Enable rootless Podman
podman_enable_rootless: true

# Users to configure for rootless Podman
podman_rootless_users: []

# Subuid and subgid ranges for rootless users
podman_subuid_start: 100000
podman_subuid_count: 65536
podman_subgid_start: 100000
podman_subgid_count: 65536

# Podman registry authentication
# Login to private registries (optional)
# NOTE: For Docker Hub, use "docker.io" as registry
# For other registries, use the hostname (e.g., "registry.example.com:5000")
#
# IMPORTANT: Authentication will be performed for:
# 1. Root user (system-wide)
# 2. Each user in podman_rootless_users list (per-user credentials)
#
podman_registries_auth: []
  # Example for Docker Hub:
  # - registry: docker.io
  #   username: myuser
  #   password: mypassword
  #
  # Example for Quay.io:
  # - registry: quay.io
  #   username: myuser
  #   password: mypassword
  #
  # Example for private registry:
  # - registry: registry.example.com:5000
  #   username: myuser
  #   password: mypassword
  #
  # Example with password from file:
  # - registry: ghcr.io
  #   username: github-user
  #   password_file: /path/to/token  # Read password from file
  #
  # Use Ansible Vault for sensitive data!

# Clean up existing credentials before re-authentication
# Set to true to remove old/invalid credentials before logging in
podman_clean_credentials: false

---
# RedHat-specific setup tasks (RHEL 9+ supported)
# Following official Docker documentation: https://docs.docker.com/engine/install/rhel/
- name: Install dnf-plugins-core (Docker official requirement)
  ansible.builtin.dnf:
    name: dnf-plugins-core
    state: present
  tags: docker

- name: Remove old Docker versions (Docker official requirement)
  ansible.builtin.dnf:
    name:
      - docker
      - docker-client
      - docker-client-latest
      - docker-common
      - docker-latest
      - docker-latest-logrotate
      - docker-logrotate
      - docker-engine
      - podman
      - runc
    state: absent
  tags: docker

- name: Configure Docker CE repository (official Docker repo for RHEL 9+)
  ansible.builtin.yum_repository:
    name: "{{ docker_yum_repo_name }}"
    description: "{{ docker_yum_repo_description }}"
    baseurl: "{{ docker_yum_repo_baseurl }}"
    gpgcheck: "{{ docker_yum_repo_gpgcheck }}"
    gpgkey: "{{ docker_yum_repo_gpgkey }}"
    enabled: "{{ docker_yum_repo_enabled }}"
  when: docker_configure_repo
  tags: docker

- name: Refresh repository metadata
  ansible.builtin.dnf:
    update_cache: true
  when: docker_configure_repo
  tags: docker

- name: Install Docker Engine packages (official Docker packages)
  ansible.builtin.dnf:
    name:
      - docker-ce
      - docker-ce-cli
      - containerd.io
      - docker-buildx-plugin
      - docker-compose-plugin
    state: present
  tags: docker




